<!DOCTYPE html>
<html>
<head>
    <title>–û—Å–æ–±–∏—Å—Ç–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/personal_page.css' %}">
</head>
<body>
    <header>
        <h1>–í—ñ—Ç–∞—é, {{ user.first_name }}!</h1>
        <p>{{ user.profile.get_category_display }}</p>
        <p>{{ user.email }}</p>
    </header>

    <aside>
        <div class="contact-info">
            <div class="contact-header">
                <h2>–ö–æ–Ω—Ç–∞–∫—Ç–∏</h2> 
                <a href="{% url 'settings' %}" target="_blank" class="settings"><img src="{% static 'settings.png' %}" alt="Settings" width="25"></a>
            </div>
            <p>–ü–æ—à—Ç–∞: {{ user.email }}</p>
            <p>–¢–µ–ª–µ—Ñ–æ–Ω: {{ contacts.phone|default:"–ù–µ –Ω–∞–¥–∞–Ω–æ" }}</p>
            <p>–°–æ—Ü. –º–µ—Ä–µ–∂—ñ: {% if contacts.socials.title and contacts.socials.link %}<a href="{{ contacts.socials.link }}" target="_blank">{{ contacts.socials.title }}</a>{% else %}–ù–µ –Ω–∞–¥–∞–Ω–æ{% endif %}</p>
            {% if user.profile.category != 'both' %}
            <a href="{% url 'change_category' %}">{% if user.profile.category == 'soldier' %}–î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é "–í–æ–ª–æ–Ω—Ç–µ—Ä(-–∫–∞)"{% else %}–î–æ–¥–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é "–í—ñ–π—Å—å–∫–æ–≤–∏–π(-–∞)"{% endif %}</a>
            {% endif %}
        </div>

        {% if request_form %}
        <div id="add-request-form-container">
            <h2>–§–æ—Ä–º–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–±–æ—Ä—É</h2>
            <form method="post">
                {% csrf_token %}
                {{ request_form.as_p }}
                <button type="submit">–î–æ–¥–∞—Ç–∏ –∑–±—ñ—Ä</button>
            </form>
        </div>
        {% endif %}
    </aside>

    <main>
        <div class="archive-section">
            <h2>–ê—Ä—Ö—ñ–≤</h2>
            {% if both_request_data %}
                {% for name, req_data in both_request_data %}
                <h3>{{name}}</h3>
                {% if req_data %}
                <table>
                    <thead>
                        <tr>
                            <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                            <th>–û–ø–∏—Å</th>
                            <th>–¶—ñ–Ω–∞ (–≥—Ä–Ω)</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    {% for req in req_data %}
                    <tbody>
                        <td>{{ req.name }}</td>
                        <td>{{ req.description }}</td>
                        <td>{{ req.aproximate_price }}</td>
                        {% if req.status == 'in_progress' and req.author.pk == user.profile.pk %}
                        <td><a href="{% url 'profile' req.volunteer.id %}">{{ req.get_status_display }}</a><br><a href="{% url 'req_ready' req.id %}">–ì–æ—Ç–æ–≤–æ</a></td>
                        {% elif req.status == 'in_progress' %}
                        <td><a href="{% url 'profile' req.author.id %}">{{ req.get_status_display }}</a></td>
                        {% else %}
                        <td>{{ req.get_status_display }}</td>
                        {% endif %}
                    </tbody>
                    {% endfor %}
                </table>
                {% else %}
                <p>–©–µ –Ω–µ–º–∞ –∑–∞–ø–∏—Ç—ñ–≤.</p>
                {% endif %}
                {% endfor %}
            {% endif %}
            {% if request_data %}
            <table>
                <thead>
                    <tr>
                        <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                        <th>–û–ø–∏—Å</th>
                        <th>–¶—ñ–Ω–∞ (–≥—Ä–Ω)</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                {% for req in request_data %}
                <tbody>
                    <td>{{ req.name }}</td>
                    <td>{{ req.description }}</td>
                    <td>{{ req.aproximate_price }}</td>
                    {% if req.status == 'in_progress' and request_form %}
                    <td><a href="{% url 'profile' req.volunteer.id %}">{{ req.get_status_display }}</a><br><a href="{% url 'req_ready' req.id %}">–ì–æ—Ç–æ–≤–æ</a></td>
                    {% elif req.status == 'in_progress' %}
                    <td><a href="{% url 'profile' req.author.id %}">{{ req.get_status_display }}</a></td>
                    {% else %}
                    <td>{{ req.get_status_display }}</td>
                    {% endif %}
                </tbody>
                {% endfor %}
            </table>
            {% elif not both_request_data %}
            <p>–©–µ –Ω–µ–º–∞ –∑–∞–ø–∏—Ç—ñ–≤.</p>
            {% endif %}

            <h2>–ú–æ—ó –º–∞—Ä–∫–µ—Ä–∏</h2>
            {% if my_markers %}
            {% for marker in my_markers %}
            <a href="{% url 'content:marker_detail' marker.id %}">{{marker.title}}</a><br>
            {% endfor %}
            {% else %}
            <p>–©–µ –Ω–µ–º–∞—î –º–∞—Ä–∫–µ—Ä—ñ–≤.</p>
            {% endif %}
        </div>

        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit">–í–∏–π—Ç–∏</button>
        </form>
    </main>

    <div class="bottom-menu">
        <a href="{% url 'map' %}">–ö–∞—Ä—Ç–∞ üî•</a>
        <a href="{% url 'volunteer_app:chat_history' %}">üïì –Ü—Å—Ç–æ—Ä—ñ—è —á–∞—Ç—ñ–≤</a>
        {% if user.profile.category != 'soldier' %}
        <a href="{% url 'volunteer_app:search' %}">–®—É–∫–∞—Ç–∏ –Ω–æ–≤—ñ –∑–±–æ—Ä–∏ üë§</a>
        {% endif %}
    </div>
</body>
</html>